<!-- Edit Tenant Page -->
 <div id="tenantData" style="display:none;" 
     data-tenant-id="<%= tenant._id %>"
     data-tenant-name="<%= tenant.firstName %> <%= tenant.lastName %>"
     data-tenant-email="<%= tenant.email %>">
</div>

<div class="tenant-edit-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>Edit Tenant</h1>
      <p><%= tenant.firstName %> <%= tenant.lastName %></p>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" onclick="window.location.href='/manager/tenant/<%= tenant._id %>'">
        <i class="fas fa-arrow-left"></i> Back to Details
      </button>
    </div>
  </div>

  <!-- Edit Form -->
  <div class="edit-form-container">
    <form id="editTenantForm" data-tenant-id="<%= tenant._id %>">
      <!-- Personal Information Section -->
      <div class="card">
        <div class="card-header">
          <h3>Personal Information</h3>
        </div>
        <div class="card-body">
          <div class="form-row">
            <div class="form-group">
              <label for="firstName">First Name *</label>
              <input type="text" id="firstName" name="firstName" value="<%= tenant.firstName %>" required>
            </div>
            <div class="form-group">
              <label for="lastName">Last Name *</label>
              <input type="text" id="lastName" name="lastName" value="<%= tenant.lastName %>" required>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="email">Email Address *</label>
              <input type="email" id="email" name="email" value="<%= tenant.email %>" required>
            </div>
            <div class="form-group">
              <label for="phone">Phone Number *</label>
              <input type="tel" id="phone" name="phone" value="<%= tenant.phone %>" required data-format="phone">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="isActive">Account Status</label>
              <select id="isActive" name="isActive">
                <option value="true" <%= tenant.isActive ? 'selected' : '' %>>Active</option>
                <option value="false" <%= !tenant.isActive ? 'selected' : '' %>>Inactive</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <!-- Lease Management Section -->
      <div class="card">
        <div class="card-header">
          <h3>Lease Information</h3>
        </div>
        <div class="card-body">
          <% if (activeLease) { %>
            <!-- Existing Lease Info -->
            <div class="current-lease-info">
              <h4>Current Lease Details</h4>
              <div class="info-grid">
                <div class="info-item">
                  <label>Unit</label>
                  <span>Unit <%= activeLease.unit.unitNumber %></span>
                </div>
                <div class="info-item">
                  <label>Start Date</label>
                  <span><%= new Date(activeLease.startDate).toLocaleDateString() %></span>
                </div>
                <div class="info-item">
                  <label>End Date</label>
                  <span><%= new Date(activeLease.endDate).toLocaleDateString() %></span>
                </div>
                <div class="info-item">
                  <label>Monthly Rent</label>
                  <span>$<%= activeLease.monthlyRent %></span>
                </div>
                <div class="info-item">
                  <label>Status</label>
                  <span class="badge badge-<%= activeLease.status %>"><%= activeLease.status %></span>
                </div>
                <div class="info-item">
                  <label>Days Remaining</label>
                  <span><%= activeLease.daysRemaining %> days</span>
                </div>
              </div>
            </div>
            
            <!-- Lease Edit Fields -->
            <div class="form-row">
              <div class="form-group">
                <label for="leaseEndDate">Lease End Date</label>
                <input type="date" id="leaseEndDate" name="leaseEndDate" value="<%= activeLease.endDate.toISOString().split('T')[0] %>">
              </div>
              <div class="form-group">
                <label for="leaseMonthlyRent">Monthly Rent</label>
                <input type="number" id="leaseMonthlyRent" name="leaseMonthlyRent" value="<%= activeLease.monthlyRent %>" min="0" step="0.01">
              </div>
            </div>
            
            <div class="form-group">
              <label for="leaseStatus">Lease Status</label>
              <select id="leaseStatus" name="leaseStatus">
                <option value="active" <%= activeLease.status === 'active' ? 'selected' : '' %>>Active</option>
                <option value="terminated" <%= activeLease.status === 'terminated' ? 'selected' : '' %>>Terminated</option>
              </select>
            </div>
            
          <% } else { %>
            <!-- No Active Lease -->
            <div class="no-lease-message">
              <p>This tenant has no active lease.</p>
              <button type="button" class="btn btn-primary" onclick="openCreateLeaseModal('<%= tenant._id %>')">
                Create New Lease
              </button>
            </div>
          <% } %>
        </div>
      </div>

      <!-- Account Security Section -->
      <div class="card">
        <div class="card-header">
          <h3>Account Security</h3>
        </div>
        <div class="card-body">
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" name="resetPassword" id="resetPassword" onchange="togglePasswordField()">
              <span>Reset password on next login</span>
            </label>
          </div>
          
          <div id="newPasswordGroup" class="form-group" style="display: none;">
            <label for="newPassword">New Password (Optional)</label>
            <div class="password-input-group">
              <input type="text" id="newPassword" name="newPassword" placeholder="Leave blank to auto-generate">
              <button type="button" class="btn btn-secondary" onclick="generatePassword()">
                Generate Password
              </button>
            </div>
            <small class="form-help">If left blank, a random password will be generated and sent to the tenant</small>
          </div>
          
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" name="sendNotification" id="sendNotification" checked>
              <span>Send email notification to tenant about changes</span>
            </label>
          </div>
        </div>
      </div>

      <!-- Notes Section -->
      <div class="card">
        <div class="card-header">
          <h3>Internal Notes</h3>
        </div>
        <div class="card-body">
          <div class="form-group">
            <label for="notes">Notes (Optional)</label>
            <textarea id="notes" name="notes" rows="4" placeholder="Add any internal notes about this tenant..."><%= tenant.notes || '' %></textarea>
            <small class="form-help">These notes are for internal use only and will not be visible to the tenant</small>
          </div>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
          <button type="button" class="btn btn-secondary" onclick="navigateBack()">
              Cancel
          </button>
          <button type="submit" class="btn btn-primary">
              <span class="btn-text">
                  <i class="fas fa-save"></i> Save Changes
              </span>
              <span class="btn-loading" style="display: none;">
                  <span class="spinner"></span> Saving...
              </span>
          </button>
      </div>
    </form>
  </div>
</div>