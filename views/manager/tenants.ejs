<!-- Tenants Management -->
<div class="tenants-container">
    <!-- Tenants Filter Bar -->
    <div class="filter-bar">
        <div class="filter-group">
            <label>Status:</label>
            <select id="statusFilter" onchange="filterTenants()">
                <option value="all">All Tenants</option>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
            </select>
        </div>
        <div class="filter-group">
            <label>Unit Status:</label>
            <select id="unitStatusFilter" onchange="filterTenants()">
                <option value="all">All</option>
                <option value="assigned">Has Unit</option>
                <option value="unassigned">No Unit</option>
            </select>
        </div>
        <div class="filter-group">
            <label>Payment Status:</label>
            <select id="paymentFilter" onchange="filterTenants()">
                <option value="all">All</option>
                <option value="current">Current</option>
                <option value="due">Payment Due</option>
            </select>
        </div>
        <div class="search-group">
            <input
                type="text"
                id="tenantSearch"
                placeholder="Search by name or email..."
                onkeyup="filterTenants()"
            />
            <i class="fas fa-search"></i>
        </div>
    </div>

    <!-- View Toggle -->
    <div class="view-toggle">
        <div class="left-buttons">
            <button class="toggle-btn active" onclick="setView('grid')">
                <i class="fas fa-th"></i> Grid View
            </button>
            <button class="toggle-btn" onclick="setView('list')">
                <i class="fas fa-list"></i> List View
            </button>
        </div>
        <button class="btn btn-primary" onclick="openAddTenantModal()">
            <i class="fas fa-plus"></i> Add New Tenant
        </button>
    </div>

    <!-- Tenants Display -->
    <div id="tenantsDisplay" class="tenants-grid-view">
        <% if (tenants && tenants.length > 0) { %> <% tenants.forEach(tenant => { %>
        <div
            class="tenant-card-full"
            data-tenant-id="<%= tenant._id %>"
            data-status="<%= tenant.isActive ? 'active' : 'inactive' %>"
            data-unit-status="<%= tenant.activeLease ? 'assigned' : 'unassigned' %>"
            data-payment-status="<%= tenant.paymentStatus %>"
            data-name="<%= tenant.firstName %> <%= tenant.lastName %>"
            data-email="<%= tenant.email %>"
        >
            <div class="tenant-card-header">
                <div class="tenant-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="tenant-header-info">
                    <h3><%= tenant.firstName %> <%= tenant.lastName %></h3>
                    <span class="email-text"><%= tenant.email %></span>
                </div>
                <span class="status-indicator <%= tenant.isActive ? 'active' : 'inactive' %>">
                    <%= tenant.isActive ? 'Active' : 'Inactive' %>
                </span>
            </div>

            <div class="tenant-card-body">
                <div class="tenant-info-grid">
                    <div class="info-item">
                        <i class="fas fa-phone"></i>
                        <span><%= tenant.phone %></span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-calendar"></i>
                        <span>Since <%= new Date(tenant.createdAt).toLocaleDateString() %></span>
                    </div>
                    <% if (tenant.activeLease && tenant.activeLease.unit) { %>
                    <div class="info-item">
                        <i class="fas fa-home"></i>
                        <span>Unit <%= tenant.activeLease.unit.unitNumber %></span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-dollar-sign"></i>
                        <span>$<%= tenant.activeLease.monthlyRent %>/mo</span>
                    </div>
                    <% } else { %>
                    <div class="info-item no-unit">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>No Active Lease</span>
                    </div>
                    <% } %>
                </div>

                <% if (tenant.activeLease && tenant.activeLease.unit) { %>
                <div class="unit-info-box">
                    <div class="unit-details">
                        <strong>Unit <%= tenant.activeLease.unit.unitNumber %></strong>
                        <span
                            ><%= tenant.activeLease.unit.propertyType %> - <%=
                            tenant.activeLease.unit.bedrooms %> bed, <%=
                            tenant.activeLease.unit.bathrooms %> bath</span
                        >
                        <span
                            ><%= tenant.activeLease.unit.streetAddress %>, <%=
                            tenant.activeLease.unit.city %>, <%= tenant.activeLease.unit.state
                            %></span
                        >
                        <span
                            >Lease ends: <%= new
                            Date(tenant.activeLease.endDate).toLocaleDateString() %></span
                        >
                    </div>
                    <div class="payment-status">
                        <span
                            class="badge <%= tenant.paymentStatus === 'current' ? 'badge-success' : 'badge-warning' %>"
                        >
                            Payment <%= tenant.paymentStatus %>
                        </span>
                    </div>
                </div>
                <% } %> <% if (tenant.lastLogin) { %>
                <div class="last-login">
                    <i class="fas fa-clock"></i>
                    Last login: <%= new Date(tenant.lastLogin).toLocaleString() %>
                </div>
                <% } %>
            </div>

            <div class="tenant-card-footer">
                <button
                    class="btn-icon"
                    onclick="viewTenant('<%= tenant._id %>')"
                    title="View Details"
                >
                    <i class="fas fa-eye"></i>
                </button>
                <button class="btn-icon" onclick="editTenant('<%= tenant._id %>')" title="Edit">
                    <i class="fas fa-edit"></i>
                </button>
                <button
                    class="btn-icon"
                    onclick="sendCredentials('<%= tenant._id %>')"
                    title="Send Credentials"
                >
                    <i class="fas fa-envelope"></i>
                </button>
                <% if (tenant.activeLease) { %>
                <button
                    class="btn btn-secondary btn-small"
                    onclick="viewLease('<%= tenant.activeLease._id %>')"
                >
                    View Lease
                </button>
                <% } %>
                <button
                    class="btn-icon danger"
                    onclick="deleteTenant('<%= tenant._id %>')"
                    title="Delete"
                >
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
        <% }) %> <% } else { %>
        <div class="empty-state">
            <i class="fas fa-users"></i>
            <h3>No Tenants Found</h3>
            <p>Start by adding your first tenant</p>
            <button class="btn btn-primary" onclick="openAddTenantModal()">Add First Tenant</button>
        </div>
        <% } %>
    </div>
</div>
