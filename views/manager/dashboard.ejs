<!-- Manager Dashboard -->
<div class="manager-container">
  <!-- Dashboard Header -->
  <%- include('../partials/page-header', {
      headerTitle: 'Manager Dashboard',
      headerSubtitle: `Welcome${user && user.firstName ? ', ' + user.firstName : ''}`,
      backButton: false
  }) %> 

  <!-- Quick Stats -->
  <div class="stats-row">
    <div class="stat-card">
      <div class="stat-icon">
        <i class="fas fa-home"></i>
      </div>
      <div class="stat-content">
        <span class="stat-value"><%= totalUnits %></span>
        <span class="stat-label">Total Units</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon occupied">
        <i class="fas fa-users"></i>
      </div>
      <div class="stat-content">
        <span class="stat-value"><%= occupiedUnits %></span>
        <span class="stat-label">Occupied</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon available">
        <i class="fas fa-key"></i>
      </div>
      <div class="stat-content">
        <span class="stat-value"><%= availableUnits %></span>
        <span class="stat-label">Available</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon service">
        <i class="fas fa-tools"></i>
      </div>
      <div class="stat-content">
        <span class="stat-value"><%= activeRequests %></span>
        <span class="stat-label">Active Requests</span>
      </div>
    </div>
  </div>

  <!-- Main Content Grid -->
  <div class="manager-grid">
    <!-- Tenants List -->
    <div class="card">
      <div class="card-header">
        <h3>All Tenants</h3>
        <a href="/manager/tenants" class="link-view-all">View All Tenants</a>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="tenants-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Unit</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Status</th>
                <th>Quick Actions</th>
              </tr>
            </thead>
            <tbody id="tenantsTableBody">
              <% if (tenants && tenants.length > 0) { %>
                <% tenants.forEach(tenant => { %>
                  <tr data-tenant-id="<%= tenant.id %>">
                    <td>
                      <div class="tenant-name">
                        <span class="name"><%= tenant.fullName %></span>
                        <% if (tenant.hasActiveLease && tenant.leaseId) { %>
                          <span class="lease-info">Lease ends: <%= tenant.leaseEnd %></span>
                          <a href="/manager/lease/<%= tenant.leaseId %>" class="lease-link">
                            View Lease Details
                          </a>
                        <% } %>
                      </div>
                    </td>
                    <td><span class="unit-badge"><%= tenant.unitNumber %></span></td>
                    <td><%= tenant.email %></td>
                    <td><%= tenant.phone %></td>
                    <td>
                      <span class="badge <%= tenant.paymentStatus === 'current' ? 'badge-success' : 'badge-warning' %>">
                        <%= tenant.paymentStatus %>
                      </span>
                    </td>
                    <td>
                      <div class="action-buttons">
                        <button class="btn-icon" onclick="viewTenant('<%= tenant.id %>')" title="View">
                          <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn-icon" onclick="editTenant('<%= tenant.id %>')" title="Edit">
                          <i class="fas fa-edit"></i>
                      </div>
                    </td>
                  </tr>
                <% }) %>
              <% } else { %>
                <tr>
                  <td colspan="6" class="text-center">No tenants found</td>
                </tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- All Units -->
    <div class="card">
        <div class="card-header">
            <h3>All Units</h3>
            <div class="units-legend">
                <span class="legend-item">
                    <span class="legend-dot occupied"></span> Occupied
                </span>
                <span class="legend-item">
                    <span class="legend-dot available"></span> Available
                </span>
            </div>
            <a href="/manager/units" class="link-view-all">View All Units</a>
        </div>
        <div class="card-body">
            <div class="units-grid">
                <% if (allUnitsList && allUnitsList.length > 0) { %>
                    <% allUnitsList.forEach(unit => { %>
                        <div class="unit-card <%= unit.occupied ? 'occupied' : 'available' %>">
                        <div class="unit-header">
                            <span class="unit-number"><%= unit.unitNumber %></span>
                            <span class="unit-type"><%= unit.propertyType %></span>
                        </div>
                        <div class="unit-address">
                            <%= unit.streetAddress %>
                        </div>
                        <div class="unit-details">
                            <span><%= unit.bedrooms %> bed, <%= unit.bathrooms %> bath</span>
                            <span><%= unit.squareFeet %> sq ft</span>
                            <span class="unit-rent">$<%= unit.monthlyRent %>/mo</span>
                        </div>
                        <div class="unit-actions">
                            <button class="btn-icon" onclick="viewUnit('<%= unit.id %>')" title="View">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn-icon" onclick="editUnitPage('<%= unit.id %>')" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    </div>
                    <% }) %>
                <% } else { %>
                    <p class="no-data">No Units</p>
                <% } %>
            </div>
        </div>
    </div>

    <!-- Recent Service Requests -->
    <div class="card">
      <div class="card-header">
        <h3>Recent Service Requests</h3>
        <a href="/manager/service-requests" class="link-view-all">View All</a>
      </div>
      <div class="card-body">
        <div class="request-list">
          <% if (recentRequests && recentRequests.length > 0) { %>
            <% recentRequests.forEach(request => { %>
              <div class="request-item-card">
                <div class="request-priority priority-<%= request.priority %>"></div>
                <div class="request-content">
                  <div class="request-title"><%= request.title %></div>
                  <div class="request-meta">
                    <span>Unit <%= request.unitNumber %></span>
                    <span><%= request.category %></span>
                    <span><%= request.date %></span>
                  </div>
                </div>
                <div class="request-status">
                  <span class="badge status-<%= request.status %>"><%= request.status %></span>
                </div>
              </div>
            <% }) %>
          <% } else { %>
            <p class="no-data">No recent service requests</p>
          <% } %>
        </div>
      </div>
    </div>

    <!-- Tenant Applications Card -->
    <div class="card">
      <div class="card-header">
        <h3>Tenant Applications</h3>
        <a href="/manager/applications-review" class="link-view-all">Review All Applications</a>
      </div>
      <div class="card-body">
        <div class="applications-summary">
          <p>Review and approve tenant applications submitted by boarding managers.</p>
          
          <div class="stats-row mt-3">
            <div class="mini-stat">
              <span class="stat-icon pending">
                <i class="fas fa-clock"></i>
              </span>
              <div class="stat-content">
                <span class="stat-label">Pending Review</span>
                <span class="stat-value" id="pendingApplicationsCount">-</span>
              </div>
            </div>
            <div class="mini-stat">
              <span class="stat-icon approved">
                <i class="fas fa-check-circle"></i>
              </span>
              <div class="stat-content">
                <span class="stat-label">Approved Today</span>
                <span class="stat-value" id="approvedTodayCount">-</span>
              </div>
            </div>
          </div>
          
          <a href="/manager/applications-review" class="btn btn-primary btn-block mt-3">
            <i class="fas fa-clipboard-check"></i> Review Applications
          </a>
        </div>
      </div>
    </div>
  </div>
</div>