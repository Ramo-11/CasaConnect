<!-- Application Details -->
<div class="application-details-container" data-application-id="<%= application._id %>">
    <!-- Page Header -->
    <%- include('../partials/page-header', {
        headerTitle: 'Application Details',
        headerSubtitle: application.firstName + ' ' + application.lastName,
        backUrl: '/boarding/dashboard',
        backText: 'Back to Dashboard',
        headerActions: application.status === 'pending' ? [] : []
    }) %>

    <!-- Application Status Banner -->
    <div class="status-banner status-<%= application.status %>">
        <div class="status-content">
            <i class="fas fa-<%= application.status === 'approved' ? 'check-circle' : application.status === 'declined' ? 'times-circle' : 'clock' %>"></i>
            <div>
                <h3>Application <%= application.status.charAt(0).toUpperCase() + application.status.slice(1) %></h3>
                <% if (application.reviewedAt) { %>
                    <p>Reviewed on <%= new Date(application.reviewedAt).toLocaleDateString() %></p>
                <% } %>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="details-grid">
        <!-- Applicant Information -->
        <div class="card">
            <div class="card-header">
                <h3>Applicant Information</h3>
            </div>
            <div class="card-body">
                <div class="info-grid">
                    <div class="info-item">
                        <label>Full Name</label>
                        <span><%= application.firstName %> <%= application.lastName %></span>
                    </div>
                    <div class="info-item">
                        <label>Email</label>
                        <span><a href="mailto:<%= application.email %>"><%= application.email %></a></span>
                    </div>
                    <div class="info-item">
                        <label>Phone</label>
                        <span><a href="tel:<%= application.phone %>"><%= application.phone %></a></span>
                    </div>
                    <div class="info-item">
                        <label>Submitted</label>
                        <span><%= new Date(application.createdAt).toLocaleString() %></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Required Documents -->
        <div class="card">
            <div class="card-header">
                <h3>Required Documents</h3>
                <% if (application.status === 'pending') { %>
                    <button class="btn btn-primary btn-small" onclick="openUploadModal()">
                        <i class="fas fa-upload"></i> Upload Document
                    </button>
                <% } %>
            </div>
            <div class="card-body">
                <div class="documents-checklist">
                    <% const requiredDocs = [
                        { key: 'id', label: 'ID/Driver License', icon: 'id-card' },
                        { key: 'ssn', label: 'Social Security Card', icon: 'file-shield' },
                        { key: 'criminal', label: 'Criminal Background Check', icon: 'user-shield' },
                        { key: 'income', label: 'Proof of Income', icon: 'money-check' },
                        { key: 'bank', label: 'Bank Statement', icon: 'university' }
                    ]; %>
                    <% requiredDocs.forEach(doc => { %>
                        <div class="document-item <%= application.documents[doc.key].documentId ? 'uploaded' : 'pending' %>">
                            <div class="document-status">
                                <i class="fas fa-<%= doc.icon %>"></i>
                                <div class="document-info">
                                    <h4><%= doc.label %></h4>
                                    <% if (application.documents[doc.key].documentId) { %>
                                        <span class="upload-date">
                                            Uploaded <%= new Date(application.documents[doc.key].uploadedAt).toLocaleDateString() %>
                                        </span>
                                        <% if (application.documents[doc.key].comment) { %>
                                            <p class="document-comment">
                                                <i class="fas fa-comment"></i> <%= application.documents[doc.key].comment %>
                                            </p>
                                        <% } %>
                                    <% } else { %>
                                        <span class="pending-text">Not uploaded</span>
                                    <% } %>
                                </div>
                            </div>
                            <div class="document-actions">
                                <% if (application.documents[doc.key].documentId) { %>
                                    <button class="btn-icon" onclick="viewDocument('<%= application.documents[doc.key].documentId._id %>')" title="View">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn-icon" onclick="downloadDocument('<%= application.documents[doc.key].documentId._id %>')" title="Download">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <% if (application.status === 'pending') { %>
                                        <button class="btn-icon danger" onclick="deleteAppDocument('<%= application._id %>', '<%= doc.key %>')" title="Delete">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    <% } %>
                                <% } else if (application.status === 'pending') { %>
                                    <button class="btn btn-secondary btn-small" onclick="openUploadModal('<%= doc.key %>')">
                                        Upload
                                    </button>
                                <% } %>
                            </div>
                        </div>
                    <% }) %>
                </div>
            </div>
        </div>

        <!-- Additional Documents -->
        <% if (application.additionalDocuments && application.additionalDocuments.length > 0) { %>
            <div class="card full-width">
                <div class="card-header">
                    <h3>Additional Documents</h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Document Title</th>
                                    <th>Comment</th>
                                    <th>Uploaded</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% application.additionalDocuments.forEach(doc => { %>
                                    <tr>
                                        <td><%= doc.title %></td>
                                        <td><%= doc.comment || '-' %></td>
                                        <td><%= new Date(doc.uploadedAt).toLocaleDateString() %></td>
                                        <td>
                                            <div class="action-buttons">
                                                <button class="btn-icon" onclick="viewDocument('<%= doc.documentId._id %>')">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="btn-icon" onclick="downloadDocument('<%= doc.documentId._id %>')">
                                                    <i class="fas fa-download"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                <% }) %>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        <% } %>

        <!-- Review Notes (if reviewed) -->
        <% if (application.reviewedBy) { %>
            <div class="card full-width">
                <div class="card-header">
                    <h3>Review Details</h3>
                </div>
                <div class="card-body">
                    <div class="review-details">
                        <div class="info-grid">
                            <div class="info-item">
                                <label>Reviewed By</label>
                                <span><%= application.reviewedBy.firstName %> <%= application.reviewedBy.lastName %></span>
                            </div>
                            <div class="info-item">
                                <label>Review Date</label>
                                <span><%= new Date(application.reviewedAt).toLocaleString() %></span>
                            </div>
                        </div>
                        <% if (application.reviewNotes) { %>
                            <div class="review-notes">
                                <label>Review Notes</label>
                                <p><%= application.reviewNotes %></p>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>
        <% } %>
    </div>
</div>

<!-- Upload Document Modal -->
<div id="uploadDocumentModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Upload Document</h2>
            <button class="modal-close" onclick="closeUploadModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="uploadDocumentForm">
                <input type="hidden" id="applicationId" value="<%= application._id %>" />

                <div class="form-group">
                    <label for="documentType">Document Type *</label>
                    <select id="documentType" name="documentType" required>
                        <option value="">Select document type...</option>
                        <% if (!application.documents.id.documentId) { %><option value="id">ID/Driver License</option><% } %>
                        <% if (!application.documents.ssn.documentId) { %><option value="ssn">Social Security Card</option><% } %>
                        <% if (!application.documents.criminal.documentId) { %><option value="criminal">Criminal Background Check</option><% } %>
                        <% if (!application.documents.income.documentId) { %><option value="income">Proof of Income</option><% } %>
                        <% if (!application.documents.bank.documentId) { %><option value="bank">Bank Statement</option><% } %>
                        <option value="other">Other Document</option>
                    </select>
                </div>

                <div class="form-group" id="customTitleGroup" style="display: none">
                    <label for="customTitle">Document Title *</label>
                    <input type="text" id="customTitle" name="customTitle" />
                </div>

                <div class="form-group">
                    <label for="documentFile">Select File *</label>
                    <input type="file" id="documentFile" name="file" required accept=".pdf,.jpg,.jpeg,.png" />
                    <small class="form-help">Max file size: 10MB. Supported: PDF, JPG, PNG</small>
                </div>

                <div class="form-group">
                    <label for="documentComment">Comment (Optional)</label>
                    <textarea id="documentComment" name="comment" rows="3" placeholder="Add any notes about this document..."></textarea>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeUploadModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <span class="btn-text">Upload Document</span>
                        <span class="btn-loading" style="display: none">
                            <span class="spinner"></span> Uploading...
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>