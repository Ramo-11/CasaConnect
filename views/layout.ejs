<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta
            name="description"
            content="<%= typeof description !== 'undefined' ? description : 'CASA CONNECT' %>"
        />
        <title>
            <%= typeof title !== 'undefined' ? title + ' | CASA CONNECT' : 'CASA CONNECT' %>
        </title>

        <!-- Favicon -->
        <link rel="icon" type="image/x-icon" href="/favicon.ico" />

        <!-- Google Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <!-- Font Awesome Icons -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&display=swap"
            rel="stylesheet"
        />

        <!-- Google Places API for Address Autocomplete -->
        <% if (typeof googleMapsApiKey !== 'undefined' && googleMapsApiKey) { %>
        <script>
            window.GOOGLE_API_KEY = "<%= googleMapsApiKey %>";
        </script>
        <script
            async
            defer
            src="https://maps.googleapis.com/maps/api/js?key=<%= googleMapsApiKey %>&libraries=places&callback=initGoogleMaps"
        ></script>
        <script>
            window.initGoogleMaps = function () {
                // This will be called when Google Maps is loaded
                if (window.initAddressAutocomplete) {
                    window.initAddressAutocomplete();
                }
            };
        </script>
        <% } %>

        <!-- CSS Files -->
        <link rel="stylesheet" href="/css/variables.css" />
        <link rel="stylesheet" href="/css/common.css" />
        <link rel="stylesheet" href="/css/layout.css" />
        <% if (typeof additionalCSS !== 'undefined') { %> <%
        additionalCSS.forEach(function(css) { %>
        <link rel="stylesheet" href="/css/<%= css %>" />
        <% }); %> <% } %> <% if (typeof stripePublicKey !== 'undefined' &&
        stripePublicKey) { %>
        <script>
            window.STRIPE_CONFIG = {
                publicKey: "<%= stripePublicKey %>",
            };
        </script>
        <script src="https://js.stripe.com/v3/"></script>
        <% } %>
    </head>
    <body>
        <!-- Main Content -->
        <main class="main-content"><%- body %></main>

        <script src="/js/utils/form-manager.js"></script>
        <script src="/js/common.js"></script>
        <script src="/js/utils/document-manager.js"></script>

        <!-- Modal Scripts - Load based on user role and page context -->
        <% if (typeof user !== 'undefined' && user && user.role === 'manager') { %>
            <script src="/js/modals/manager-tenant-modal.js"></script>
            <script src="/js/modals/manager-unit-modal.js"></script>
            <script src="/js/modals/manager-lease-modal.js"></script>
        <% } %>

        <!-- Modal Partials - Include based on page needs -->
        <% if (typeof user !== 'undefined' && user && user.role === 'manager') { %>
            <% 
            // Determine which modals to include based on the current page
            const currentPath = typeof path !== 'undefined' ? path : '';
            const includeTenantModals = currentPath.includes('tenant') || currentPath.includes('dashboard');
            const includeUnitModals = currentPath.includes('unit') || currentPath.includes('dashboard');
            const includeLeaseModals = includeTenantModals || includeUnitModals; // Lease modals needed on both
            %>

            <%- include('partials/modals/shared-modals') %>

            <% if (includeTenantModals) { %>
                <%- include('partials/modals/tenant-modals') %>
            <% } %>
            
            <% if (includeUnitModals) { %>
                <%- include('partials/modals/unit-modals') %>
            <% } %>
            
            <% if (includeLeaseModals) { %>
                <%- include('partials/modals/lease-modals') %>
            <% } %>
        <% } %>
        
        <% if (typeof additionalJS !== 'undefined') { %> <%
            additionalJS.forEach(function(js) { %>
            <script src="/js/<%= js %>"></script>
        <% }); %> <% } %>
    </body>
</html>